$(document).ready(function(){initHeaderBack();initShowLoading()});function initHeaderBack(){if($("#section_container").attr("data-add-back-btn")=="true"){$("header .left").show()}else{$("header .left").hide()}}function initShowLoading(){$("a").click(function(){if($(this).attr("data-target")=="link"||$(this).attr("data-target")=="back"){J.showMask("加载中...")}})}function disabledBtn(btnSubmit){J.showMask('加载中...');btnSubmit.attr("disabled",true)}function enableBtn(btnSubmit){J.hideMask();btnSubmit.attr("disabled",false)};
document.addEventListener("deviceready",onDeviceReady,false);function onDeviceReady(){navigator.splashscreen.hide();document.addEventListener("backbutton",function(e){if(J.hasMenuOpen){J.Menu.hide()}else{if(J.hasPopupOpen){J.closePopup()}else{var sectionId=$("section.active").attr("id");if(sectionId=="index_section"){J.confirm("??","???????",function(){navigator.app.exitApp()})}else{window.history.go(-1)}}}},false)}var App=(function(){var pages={};var run=function(){$.each(pages,function(k,v){var sectionId="#"+k+"_section";$("body").delegate(sectionId,"pageinit",function(){v.init&&v.init.call(v)});$("body").delegate(sectionId,"pageshow",function(e,isBack){v.show&&v.show.call(v);if(!isBack&&v.load){v.load.call(v)}})});J.Transition.add("flip","slideLeftOut","flipOut","slideRightOut","flipIn");Jingle.launch({})};var page=function(id,factory){return((id&&factory)?_addPage:_getPage).call(this,id,factory)};var _addPage=function(id,factory){pages[id]=new factory()};var _getPage=function(id){return pages[id]};var calcChartOffset=function(){return{height:$(document).height()-44-30-60,width:$(document).width()}};return{run:run,page:page,calcChartOffset:calcChartOffset}}());$(function(){App.run()});
var Jingle=J={version:"0.4",$:window.Zepto,settings:{appType:"muti",transitionType:"slide",transitionTime:250,transitionTimingFunc:"ease-in",showWelcome:false,showPageLoading:true,basePagePath:"html/",remotePage:{}},mode:window.innerWidth<800?"phone":"tablet",hasTouch:"ontouchstart" in window,launchCompleted:false,hasMenuOpen:false,hasPopupOpen:false,isWebApp:location.protocol=="http:",launch:function(opts){$.extend(this.settings,opts);var hasShowWelcome=window.localStorage.getItem("hasShowWelcome");if(!hasShowWelcome&&this.settings.showWelcome){this.Welcome.show()}if(this.settings.appType=="single"){this.Router.init()}else{$(document).on("click",'a[data-target="back"]',function(e){e.preventDefault();window.history.go(-1)})}this.Element.init();this.Menu.init();this.Selected.init()}};J.Element=(function($){var SELECTOR={"icon":"[data-icon]","scroll":'[data-scroll="true"]',"toggle":".toggle","range":"[data-rangeinput]","progress":"[data-progress]","count":"[data-count]","checkbox":"[data-checkbox]"};var init=function(selector){if(!selector){$(document).on("articleshow","article",function(){J.Element.initScroll(this)})}var $el=$(selector||"body");if($el.length==0){return}$.map(_getMatchElements($el,SELECTOR.icon),_init_icon);$.map(_getMatchElements($el,SELECTOR.toggle),_init_toggle);$.map(_getMatchElements($el,SELECTOR.range),_init_range);$.map(_getMatchElements($el,SELECTOR.progress),_init_progress);$.map(_getMatchElements($el,SELECTOR.count),_init_badge);$.map(_getMatchElements($el,SELECTOR.checkbox),_init_checkbox)};var _getMatchElements=function($el,selector){return $el.find(selector).add($el.filter(selector))};var initScroll=function(selector){$.map(_getMatchElements($(selector),SELECTOR.scroll),function(el){J.Scroll(el)})};var _init_icon=function(el){var $el=$(el),$icon=$el.children("i.icon"),icon=$el.data("icon");if($icon.length>0){$icon.attr("class","icon "+icon)}else{$el.prepend('<i class="icon '+icon+'"></i>')}};var _init_toggle=function(el){var $el=$(el),$input;
if($el.find("div.toggle-handle").length>0){return}var name=$el.attr("name");if(name){$el.append('<input style="display: none;" name="'+name+'" value="'+$el.hasClass("active")+'"/>')}$el.append('<div class="toggle-handle"></div>');$input=$el.find("input");$el.tap(function(){var value;if($el.hasClass("active")){$el.removeClass("active");value=false}else{$el.addClass("active");value=true}$input.val(value);$el.trigger("toggle")})};var _init_range=function(el){var $el=$(el),$input;var $range=$('input[type="range"]',el);var align=$el.data("rangeinput");var input=$('<input type="text" name="test" value="'+$range.val()+'"/>');if(align=="left"){$input=input.prependTo($el)}else{$input=input.appendTo($el)}var max=parseInt($range.attr("max"),10);var min=parseInt($range.attr("min"),10);$range.change(function(){$input.val($range.val())});$input.on("input",function(){var value=parseInt($input.val(),10);value=value>max?max:(value<min?min:value);$range.val(value);$input.val(value)})};var _init_progress=function(el){var $el=$(el),$bar;var progress=parseFloat($el.data("progress"))+"%";var title=$el.data("title")||"";$bar=$el.find("div.bar");if($bar.length==0){$bar=$('<div class="bar"></div>').appendTo($el)}$bar.width(progress).text(title+progress);if(progress=="100%"){$bar.css("border-radius","10px")}};var _init_badge=function(el){var $el=$(el),$count;var count=parseInt($el.data("count"));var orient=$el.data("orient");var className=(orient=="left")?"left":"";var $markup=$('<span class="count '+className+'">'+count+"</span>");$count=$el.find("span.count");if($count.length>0){$count.text(count)}else{$count=$markup.appendTo($el)}if(count==0){$count.hide()}};var _init_checkbox=function(el){var $el=$(el);var value=$el.data("checkbox");if($el.find("i.icon").length>0){return}$el.prepend('<i class="icon checkbox-'+value+'"></i>');$el.on("tap",function(){var status=($el.data("checkbox")=="checked")?"unchecked":"checked";$el.find("i.icon").attr("class","icon checkbox-"+status);$el.data("checkbox",status);
$el.trigger("change")})};return{init:init,initIcon:_init_icon,initToggle:_init_toggle,initProgress:_init_progress,initRange:_init_range,initBadge:_init_badge,initScroll:initScroll}})(J.$);J.Menu=(function($){var $asideContainer,$sectionContainer,$sectionMask;var init=function(){$asideContainer=$("#aside_container");$sectionContainer=$("#section_container");$sectionMask=$('<div id="section_container_mask"></div>').appendTo("#section_container");$sectionMask.on("tap",hideMenu);$asideContainer.on("swipeRight","aside",function(){if($(this).data("position")=="right"){hideMenu()}});$asideContainer.on("swipeLeft","aside",function(){if($(this).data("position")!="right"){hideMenu()}});$asideContainer.on("tap",".aside-close",hideMenu)};var showMenu=function(selector){var $aside=$(selector).addClass("active"),transition=$aside.data("transition"),position=$aside.data("position")||"left",showClose=$aside.data("show-close"),width=$aside.width(),translateX=position=="left"?width+"px":"-"+width+"px";if(showClose&&$aside.find("div.aside-close").length==0){$aside.append('<div class="aside-close icon close"></div>')}J.Element.initScroll($aside);if(transition=="overlay"){J.anim($aside,{translateX:"0%"})}else{if(transition=="reveal"){J.anim($sectionContainer,{translateX:translateX})}else{J.anim($aside,{translateX:"0%"});J.anim($sectionContainer,{translateX:translateX})}}$("#section_container_mask").show();J.hasMenuOpen=true};var hideMenu=function(duration,callback){var $aside=$("#aside_container aside.active"),transition=$aside.data("transition"),position=$aside.data("position")||"left",translateX=position=="left"?"-100%":"100%";var _finishTransition=function(){$aside.removeClass("active");J.hasMenuOpen=false;callback&&callback.call(this)};if(transition=="overlay"){J.anim($aside,{translateX:translateX},duration,_finishTransition)}else{if(transition=="reveal"){J.anim($sectionContainer,{translateX:"0"},duration,_finishTransition)}else{J.anim($aside,{translateX:translateX},duration);J.anim($sectionContainer,{translateX:"0"},duration,_finishTransition)
}}$("#section_container_mask").hide()};return{init:init,show:showMenu,hide:hideMenu}})(J.$);J.Page=(function($){var _formatHash=function(hash){return hash.indexOf("#")==0?hash.substr(1):hash};var loadSectionTpl=function(hash,callback){var param={},query,appendTpl=true;if($.type(hash)=="object"){hash=hash.tag;param=hash.param;query=hash.query}var q=$(hash).data("query");if($(hash).length==1&&q==query){if(q==query){callback();return}else{appendTpl=false}}var id=_formatHash(hash);var url=J.settings.remotePage[hash];url||(url=J.settings.basePagePath+id+".html");J.settings.showPageLoading&&J.showMask();loadContent(url,param,function(html){J.settings.showPageLoading&&J.hideMask();if(!appendTpl){$(hash).remove()}$("#section_container").append(html);$(hash).trigger("pageload").data("query",query);J.Element.init(hash);callback()})};var loadSectionRemote=function(url,section){var param=J.Util.parseHash(window.location.hash).param;loadContent(url,param,function(html){$(section).html(html);J.Element.init(section)})};var loadContent=function(url,param,callback){return $.ajax({url:url,timeout:20000,data:param,success:function(html){callback&&callback(html)}})};return{load:loadSectionTpl,loadSection:loadSectionRemote,loadContent:loadContent}})(J.$);J.Router=(function($){var _history=[];var init=function(){$(window).on("popstate",_popstateHandler);$(document).on("click","a",function(e){var target=$(this).data("target");if(!target||target!="link"){e.preventDefault();return false}});$(document).on("tap","a",function(e){var target=$(this).data("target");if(!target){e.preventDefault()}else{if(target!="link"){e.preventDefault();_targetHandler.call(this)}}});_initIndex()};var _initIndex=function(){var currentHash=location.hash;var $section=$("#section_container section.active");_add2History("#"+$section.attr("id"));$section.trigger("pageinit").trigger("pageshow").data("init",true).find("article.active").trigger("articleshow");if(currentHash!=""){_showSection(currentHash)}};var _popstateHandler=function(e){if(e.state&&e.state.hash){var hash=e.state.hash;
if(_history[1]&&hash===_history[1].hash){J.Menu.hide();J.Popup.close();back()}else{return}}else{return}};var _targetHandler=function(){var _this=$(this),target=_this.attr("data-target"),href=_this.attr("href");switch(target){case"section":_showSection(href);break;case"article":_showArticle(href,_this);break;case"menu":_toggleMenu(href);break;case"back":back();break}};var _showSection=function(hash){if(J.hasMenuOpen){J.Menu.hide(200,function(){_showSection(hash)});return}var hashObj=J.Util.parseHash(hash);if(_history[0].tag===hashObj.tag){return}J.Page.load(hashObj,function(){_changePage(_history[0].tag,hashObj.tag);_add2History(hash)})};var back=function(){_changePage(_history.shift().tag,_history[0].tag,true);window.history.replaceState(_history[0],"",_history[0].hash)};var _changePage=function(current,target,isBack){J.Transition.run(current,target,isBack)};var _add2History=function(hash){var hashObj=J.Util.parseHash(hash);_history.unshift(hashObj);window.history.pushState(hashObj,"",hash)};var _showArticle=function(href,el){var article=$(href);if(article.hasClass("active")){return}el.addClass("active").siblings(".active").removeClass("active");var activeArticle=article.addClass("active").siblings(".active").removeClass("active");article.trigger("articleshow");activeArticle.trigger("articlehide")};var _toggleMenu=function(hash){J.hasMenuOpen?J.Menu.hide():J.Menu.show(hash)};return{init:init,goTo:_showSection,showArticle:_showArticle,back:back}})(J.$);J.Service=(function($){var UNPOST_KEY="JINGLE_POST_DATA",GET_KEY_PREFIX="JINGLE_GET_";var ajax=function(options){if(options.type=="post"){_doPost(options)}else{_doGet(options)}};var _doPost=function(options){if(J.offline){_setUnPostData(options.url,options.data);options.success("???????")}else{$.ajax(options)}};var _doGet=function(options){var key=options.url+JSON.stringify(options.data);if(J.offline){var result=_getCache(key);if(result){options.success(result.data,key,result.cacheTime)}else{options.success(result)}}else{var callback=options.success;
options.success=function(result){_saveData2local(key,result);callback(result,key)};$.ajax(options)}};var _getCache=function(key){return JSON.parse(window.localStorage.getItem(GET_KEY_PREFIX+key))};var _saveData2local=function(key,result){var data={data:result,cacheTime:new Date()};window.localStorage.setItem(GET_KEY_PREFIX+key,JSON.stringify(data))};var _setUnPostData=function(url,result){var data=getUnPostData();data=data||{};data[url]={data:result,createdTime:new Date()};window.localStorage.setItem(UNPOST_KEY,JSON.stringify(data))};var getUnPostData=function(url){var data=JSON.parse(window.localStorage.getItem(UNPOST_KEY));return(data&&url)?data[url]:data};var removeUnPostData=function(url){if(url){var data=getUnPostData();delete data[url];window.localStorage.setItem(UNPOST_KEY,JSON.stringify(data))}else{window.localStorage.removeItem(UNPOST_KEY)}};var syncPostData=function(url,success,error){var unPostData=getUnPostData(url).data;$.ajax({url:url,contentType:"application/json",data:unPostData,type:"post",success:function(){success(url)},error:function(){error(url)}})};var syncAllPostData=function(success,error){var unPostData=getUnPostData();for(var url in unPostData){syncPostData(url,success,error)}removeUnPostData()};function parseArguments(url,data,success,dataType){var hasData=!$.isFunction(data);return{url:url,data:hasData?data:undefined,success:!hasData?data:$.isFunction(success)?success:undefined,dataType:hasData?dataType||success:success}}var get=function(url,data,success,dataType){return ajax(parseArguments.apply(null,arguments))};var post=function(url,data,success,dataType){var options=parseArguments.apply(null,arguments);options.type="POST";return ajax(options)};var getJSON=function(url,data,success){var options=parseArguments.apply(null,arguments);options.dataType="json";return ajax(options)};var clear=function(){var storage=window.localStorage;var keys=[];for(var i=0;i<storage.length;i++){var key=storage.key(i);key.indexOf(GET_KEY_PREFIX)==0&&keys.push(key)
}for(var i=0;i<keys.length;i++){storage.removeItem(keys[i])}storage.removeItem(UNPOST_KEY)};return{ajax:ajax,get:get,post:post,getJSON:getJSON,getUnPostData:getUnPostData,removeUnPostData:removeUnPostData,syncPostData:syncPostData,syncAllPostData:syncAllPostData,getCacheData:_getCache,saveCacheData:_saveData2local,clear:clear}})(J.$);J.Template=(function($){var background=function(el,title,icon){var markup='<div class="back-mask"><div class="icon '+icon+'"></div><div>'+title+"</div></div>";$(el).html(markup)};var no_result=function(el){background(el,"????????","drawer")};var loading=function(el){background(el,"???...","cloud-download")};var render=function(containerSelector,templateId,data,type){var el=$(containerSelector),type=type||"replace";if($.type(data)=="array"&&data.length==0){no_result(el)}else{var html=$(template(templateId,data));if(type=="replace"){el.html(html)}else{el.append(html)}J.Element.init(html)}};return{render:render,background:background,loading:loading,no_result:no_result}})(J.$);J.Toast=(function($){var TOAST_DURATION=5000;var TEMPLATE={toast:'<a href="#">{value}</a>',success:'<a href="#"><i class="icon checkmark-circle"></i>{value}</a>',error:'<a href="#">{value}</a></div>',info:'<a href="#"><i class="icon info-2"></i>{value}</a>'};var toast_type="toast",_toast,timer;var _init=function(){$("body").append('<div id="jingle_toast"></div>');_toast=$("#jingle_toast");_subscribeCloseTag()};var hide=function(){J.anim(_toast,"scaleOut",function(){_toast.hide();_toast.empty()})};var show=function(type,text,duration){if(timer){clearTimeout(timer)}toast_type=type;_toast.attr("class",type).html(TEMPLATE[type].replace("{value}",text)).show();J.anim(_toast,"scaleIn");if(duration!==0){timer=setTimeout(hide,duration||TOAST_DURATION)}};var _subscribeCloseTag=function(){_toast.on("tap",'[data-target="close"]',function(){hide()})};_init();return{show:show,hide:hide}})(J.$);J.Transition=(function($){var isBack,$current,$target,transitionName,animationClass={slide:[["slideLeftOut","slideLeftIn"],["slideRightOut","slideRightIn"]],cover:[["","slideLeftIn"],["slideRightOut",""]],slideUp:[["","slideUpIn"],["slideDownOut",""]],slideDown:[["","slideDownIn"],["slideUpOut",""]],popup:[["","scaleIn"],["scaleOut",""]]};
var _doTransition=function(){$current.trigger("beforepagehide",[isBack]);$target.trigger("beforepageshow",[isBack]);var c_class=transitionName[0]||"empty",t_class=transitionName[1]||"empty";$current.bind("webkitAnimationEnd.jingle",_finishTransition);$current.addClass("anim "+c_class);$target.addClass("anim animating "+t_class)};var _finishTransition=function(){$current.off("webkitAnimationEnd.jingle");$target.off("webkitAnimationEnd.jingle");$current.attr("class","");$target.attr("class","active");if(!$target.data("init")){$target.trigger("pageinit");$target.data("init",true)}$current.trigger("pagehide",[isBack]);$target.trigger("pageshow",[isBack]);$current.find("article.active").trigger("articlehide");$target.find("article.active").trigger("articleshow")};var run=function(current,target,back){$(":focus").trigger("blur");isBack=back;$current=$(current);$target=$(target);var type=isBack?$current.attr("data-transition"):$target.attr("data-transition");type=type||J.settings.transitionType;transitionName=isBack?animationClass[type][1]:animationClass[type][0];_doTransition()};var addAnimation=function(name,currentOut,targetIn,backCurrentOut,backCurrentIn){if(animationClass[name]){console.error("??????????????????????(??????)");return}animationClass[name]=[[currentOut,targetIn],[backCurrentOut,backCurrentIn]]};return{run:run,add:addAnimation}})(J.$);J.Util=(function($){var parseHash=function(hash){var tag,query,param={};var arr=hash.split("?");tag=arr[0];if(arr.length>1){var seg,s;query=arr[1];seg=query.split("&");for(var i=0;i<seg.length;i++){if(!seg[i]){continue}s=seg[i].split("=");param[s[0]]=s[1]}}return{hash:hash,tag:tag,query:query,param:param}};var formatDate=function(date,format){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),"S":date.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))
}for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return format};return{parseHash:parseHash,formatDate:formatDate}})(J.$);J.Welcome=(function($){var showWelcome=function(){$.ajax({url:J.settings.basePagePath+"welcome.html",timeout:5000,async:false,success:function(html){$("body").append(html);new J.Slider("#jingle_welcome")}})};var hideWelcome=function(){J.anim("#jingle_welcome","slideLeftOut",function(){$(this).remove();window.localStorage.setItem("hasShowWelcome",true)})};return{show:showWelcome,hide:hideWelcome}})(J.$);J.anim=function(el,animName,duration,ease,callback){var d,e,c;var len=arguments.length;for(var i=2;i<len;i++){var a=arguments[i];var t=$.type(a);t=="number"?(d=a):(t=="string"?(e=a):(t=="function")?(c=a):null)}$(el).animate(animName,d||J.settings.transitionTime,e||J.settings.transitionTimingFunc,c)};J.showMask=function(text){J.Popup.loading(text)};J.hideMask=function(){J.Popup.close(true)};J.showToast=function(text,type,duration){type=type||"toast";J.Toast.show(type,text,duration)};J.hideToast=function(){J.Toast.hide()};J.alert=function(title,content){J.Popup.alert(title,content)};J.confirm=function(title,content,okCall,cancelCall){J.Popup.confirm(title,content,okCall,cancelCall)};J.customConfirm=function(title,content,ok,cancel,okCall,cancelCall){J.Popup.customConfirm(title,content,ok,cancel,okCall,cancelCall)};J.popup=function(options){J.Popup.show(options)};J.closePopup=function(){J.Popup.close()};J.popover=function(html,pos,arrowDirection,onShow){J.Popup.popover(html,pos,arrowDirection,onShow)};J.tmpl=function(containerSelector,templateId,data,type){J.Template.render(containerSelector,templateId,data,type)};J.Popup=(function($){var _popup,_mask,transition,clickMask2close,POSITION={"top":{top:0,left:0,right:0},"top-second":{top:"44px",left:0,right:0},"center":{top:"50%",left:"5%",right:"5%","border-radius":"3px"},"bottom":{bottom:0,left:0,right:0},"bottom-second":{bottom:"51px",left:0,right:0}},ANIM={top:["slideDownIn","slideUpOut"],bottom:["slideUpIn","slideDownOut"],defaultAnim:["bounceIn","bounceOut"]},TEMPLATE={alert:'<a data-target="closePopup"><img class="w100" src="{title}" /></a>',confirm:'<div class="popup-title">{title}</div><div class="popup-content">{content}</div><div id="popup_btn_container"><a class="cancel" data-icon="close">{cancel}</a><a data-icon="checkmark">{ok}</a></div>',customConfirm:'<div class="popup-title">{title}</div><div class="popup-content">{content}</div><div id="popup_btn_container">{cancel}{ok}</div>',loading:'<i class="icon spinner"></i><p>{title}</p>'};
var _init=function(){$("body").append('<div id="jingle_popup"></div><div id="jingle_popup_mask"></div>');_mask=$("#jingle_popup_mask");_popup=$("#jingle_popup");_subscribeEvents()};var show=function(options){var settings={height:undefined,width:undefined,opacity:0.3,url:null,tplId:null,tplData:null,html:"",pos:"center",clickMask2Close:true,showCloseBtn:true,arrowDirection:undefined,animation:false,timingFunc:"linear",duration:200,onShow:undefined};$.extend(settings,options);clickMask2close=settings.clickMask2Close;_mask.css("opacity",settings.opacity);_popup.attr({"style":"","class":""});settings.width&&_popup.width(settings.width);settings.height&&_popup.height(settings.height);var pos_type=$.type(settings.pos);if(pos_type=="object"){_popup.css(settings.pos);transition=ANIM["defaultAnim"]}else{if(pos_type=="string"){if(POSITION[settings.pos]){_popup.css(POSITION[settings.pos]);var trans_key=settings.pos.indexOf("top")>-1?"top":(settings.pos.indexOf("bottom")>-1?"bottom":"defaultAnim");transition=ANIM[trans_key]}else{_popup.addClass(settings.pos);transition=ANIM["defaultAnim"]}}else{console.error("??????");return}}_mask.show();var html;if(settings.html){html=settings.html}else{if(settings.url){html=J.Page.loadContent(settings.url)}else{if(settings.tplId){html=template(settings.tplId,settings.tplData)}}}if(settings.showCloseBtn){html+='<div id="tag_close_popup" data-target="closePopup" class="icon cancel-circle"></div>'}if(settings.arrowDirection){_popup.addClass("arrow "+settings.arrowDirection);_popup.css("padding","8px");if(settings.arrowDirection=="top"||settings.arrowDirection=="bottom"){transition=ANIM[settings.arrowDirection]}}_popup.html(html).show();J.Element.init(_popup);settings.onShow&&settings.onShow.call(_popup);if(settings.pos=="center"){var height=_popup.height();_popup.css("margin-top","-"+height/2+"px")}J.Element.init(_popup);if(settings.animation){J.anim(_popup,transition[0],settings.duration,settings.timingFunc)}J.hasPopupOpen=true};var hide=function(noTransition){_mask.hide();
if(transition&&!noTransition){_popup.hide().empty();J.hasPopupOpen=false}else{_popup.hide().empty();J.hasPopupOpen=false}};var _subscribeEvents=function(){_mask.on("tap",function(){if(clickMask2close){hide()}});_popup.on("tap",'[data-target="closePopup"]',function(){hide()})};var alert=function(title,content){var markup=TEMPLATE.alert.replace("{title}",title).replace("{content}",content).replace("{ok}","??");show({html:markup,pos:"center",clickMask2Close:false,showCloseBtn:false})};var confirm=function(title,content,okCall,cancelCall){var markup=TEMPLATE.confirm.replace("{title}",title).replace("{content}",content).replace("{cancel}","??").replace("{ok}","??");show({html:markup,pos:"center",clickMask2Close:false,showCloseBtn:false});$('#popup_btn_container [data-icon="checkmark"]').tap(function(){hide();okCall.call(this)});$('#popup_btn_container [data-icon="close"]').tap(function(){hide();cancelCall.call(this)})};var customConfirm=function(title,content,ok,cancel,okCall,cancelCall){var markup=TEMPLATE.customConfirm.replace("{title}",title).replace("{content}",content).replace("{cancel}",ok).replace("{ok}",cancel);show({html:markup,pos:"center",clickMask2Close:false,showCloseBtn:false});$('#popup_btn_container [data="ok"]').tap(function(){hide();okCall.call(this)});$('#popup_btn_container [data="cancel"]').tap(function(){hide();cancelCall.call(this)})};var popover=function(html,pos,arrow_direction,onShow){show({html:html,pos:pos,showCloseBtn:false,arrowDirection:arrow_direction,onShow:onShow})};var loading=function(text){var markup=TEMPLATE.loading.replace("{title}",text||"???...");show({html:markup,pos:"loading",opacity:0,animation:false,clickMask2Close:false})};var actionsheet=function(buttons){var markup='<div class="actionsheet">';$.each(buttons,function(i,n){markup+='<ul class="list">'+'<li class="text-center">'+'<a href="'+n.href+'" data-target="'+n.target+'" class="font-type" style="color:'+n.color+';">'+n.text+"</a>"+"</li>"});markup+="</ul></div>";show({html:markup,pos:"bottom",showCloseBtn:false,onShow:function(){$(this).find("button").each(function(i,button){$(button).on("tap",function(){if(buttons[i]&&buttons[i].handler){buttons[i].handler.call(button)
}hide()})})}})};_init();return{show:show,close:hide,alert:alert,confirm:confirm,customConfirm:customConfirm,popover:popover,loading:loading,actionsheet:actionsheet}})(J.$);J.Selected=(function($){var SELECTOR="[data-selected]",activeEl,timer;var init=function(){$(document).on("touchstart.selected",SELECTOR,function(){var $el=$(this);timer=setTimeout(function(){activeEl=$el.addClass($el.data("selected"))},50)});$(document).on("touchmove.selected touchend.selected touchcancel.selected",function(){timer&&clearTimeout(timer);if(activeEl){activeEl.removeClass(activeEl.data("selected"));activeEl=null}})};return{init:init}})(J.$);J.Cache=(function($){var UNPOST_KEY="_J_P_",GET_KEY_PREFIX="_J_";var save=function(key,value){var data={data:value,cacheTime:new Date()};window.localStorage.setItem(GET_KEY_PREFIX+key,JSON.stringify(data))};var get=function(key){return JSON.parse(window.localStorage.getItem(GET_KEY_PREFIX+key))};var savePost=function(url,result){var data=getPost();data=data||{};data[url]={data:result,createdTime:new Date()};window.localStorage.setItem(UNPOST_KEY,JSON.stringify(data))};var getPost=function(url){var data=JSON.parse(window.localStorage.getItem(UNPOST_KEY));return(data&&url)?data[url]:data};var removePost=function(url){if(url){var data=getPost();delete data[url];window.localStorage.setItem(UNPOST_KEY,JSON.stringify(data))}else{window.localStorage.removeItem(UNPOST_KEY)}};var syncPost=function(url,success,error){var dataLen,index=0;if($.type(url)=="string"){dataLen=1;sync(url)}else{var postData=getPost();if(!postData){return}dataLen=postData.length;for(var url in postData){sync(url)}}function sync(url){var data=getPost(url).data;$.ajax({url:url,contentType:"application/json",data:data,type:"post",success:function(){index++;removePost(url);if(index==dataLen){success(url)}},error:function(){error(url)}})}};var clear=function(){var storage=window.localStorage;for(var key in storage){if(key.indexOf(GET_KEY_PREFIX)==0){storage.removeItem(key)}}storage.removeItem(UNPOST_KEY)
};return{get:get,save:save,getPost:getPost,savePost:savePost,removePost:removePost,syncPost:syncPost,clear:clear}})(J.$);(function($){var calendar=function(selector,options){var defaults={months:["01?","02?","03?","04?","05?","06?","07?","08?","09?","10?","11?","12?"],days:["?","?","?","?","?","?","?"],swipeable:true,date:new Date(),onRenderDay:undefined,onSelect:undefined},_this=this,$el=$(selector),$yearText,$monthText,$calendarBody,currentDate,currentYear,currentMonth;var _init=function(){_this.settings=$.extend({},defaults,options);currentYear=_this.settings.date.getFullYear();currentMonth=_this.settings.date.getMonth();currentDate=new Date(currentYear,currentMonth,_this.settings.date.getDate());_render();_subscribeEvents()};var _fisrtDayOfMonth=function(date){return(new Date(date.getFullYear(),date.getMonth(),1)).getDay()};var _daysInMonth=function(date){return(new Date(date.getFullYear(),date.getMonth()+1,0)).getDate()};var _render=function(){var html="";html+='<div class="jingle-calendar">';html+=_renderNav(currentYear,currentMonth);html+=_renderHead();html+='<div class="jingle-calendar-body">';html+=_renderBody(currentDate);html+="</div></div>";$el.html(html);var $span=$el.find("span");$yearText=$span.eq(0);$monthText=$span.eq(1);$calendarBody=$el.find(".jingle-calendar-body")};var _renderNav=function(year,month){var html='<div class="jingle-calendar-nav">';html+='<div> <i class="icon previous" data-year='+year+"></i><span>"+year+'</span><i class="icon next" data-year='+year+"></i></div>";html+='<div ><i class="icon previous" data-month='+month+"></i> <span>"+_this.settings.months[month]+'</span><i class="icon next" data-month='+month+"></i></div>";html+="</div>";return html};var _renderHead=function(){var html="<table><thead><tr>";for(var i=0;i<7;i++){html+="<th>"+_this.settings.days[i]+"</th>"}html+="</tr></thead></table>";return html};var _renderBody=function(date){var firstDay=_fisrtDayOfMonth(date),days=_daysInMonth(date),rows=Math.ceil((firstDay+days)/7),beginDate,html="";
currentYear=date.getFullYear();currentMonth=date.getMonth();beginDate=new Date(currentYear,currentMonth,1-firstDay);html+="<table><tbody>";for(var i=0;i<rows;i++){html+="<tr>";for(var j=0;j<7;j++){html+=_renderDay(beginDate,currentMonth);beginDate.setDate(beginDate.getDate()+1)}html+="</tr>"}html+="</tbody></table>";return html};var _renderDay=function(date,month){var otherMonth=(date.getMonth()!==month);var dateStr=_this.format(date);var classname=(_this.format(new Date())==dateStr)?"active disabled":"";if(date<_this.settings.date){classname+=" disabled"}var dayStr=date.getDate();if(_this.settings.onRenderDay){dayStr=_this.settings.onRenderDay.call(null,dayStr,dateStr)}return otherMonth?"<td>&nbsp;</td>":'<td data-selected="selected" class="'+classname+'" data-date= '+dateStr+">"+dayStr+"</td>"};var _subscribeEvents=function(){var $target,$ctarget;$el.on("tap",function(e){$target=$(e.target);if($target.is("[data-year].next")){currentDate.setFullYear(currentDate.getFullYear()+1);_this.refresh(currentDate)}else{if($target.is("[data-year].previous")){currentDate.setFullYear(currentDate.getFullYear()-1);_this.refresh(currentDate)}else{if($target.is("[data-month].next")){currentDate.setMonth(currentDate.getMonth()+1);_this.refresh(currentDate)}else{if($target.is("[data-month].previous")){currentDate.setMonth(currentDate.getMonth()-1);_this.refresh(currentDate)}}}}$ctarget=$target.closest("td");if(!$target.is("td")&&$ctarget.length>0){$target=$ctarget}if($target.is("td")){var dateStr=$target.data("date");var isDisabledOrNot=0;if(dateStr){isDisabledOrNot=$target.attr("class").indexOf("disabled")}if(dateStr&&_this.settings.onSelect&&isDisabledOrNot<0){_this.settings.onSelect.call(_this,dateStr)}}});$el.on("swipeLeft",function(){currentDate.setMonth(currentDate.getMonth()+1);_this.refresh(currentDate)});$el.on("swipeRight",function(){currentDate.setMonth(currentDate.getMonth()-1);_this.refresh(currentDate)})};this.refresh=function(date){var oldDate=new Date(currentYear,currentMonth,1),newDate=new Date(date.getFullYear(),date.getMonth(),1),transition=undefined,$table;
if(oldDate.getTime()==newDate.getTime()){return}transition=oldDate<newDate?"slideLeftRound":"slideRightRound";$yearText.text(date.getFullYear());$monthText.text(this.settings.months[date.getMonth()]);var newbody=_renderBody(date);J.anim($calendarBody,transition,function(){$calendarBody.html(newbody)})};_init()};calendar.prototype.parse=function(date){var dateRE=/^(\d{4})(?:\-|\/)(\d{1,2})(?:\-|\/)(\d{1,2})$/;return dateRE.test(date)?new Date(parseInt(RegExp.$1,10),parseInt(RegExp.$2,10)-1,parseInt(RegExp.$3,10)):null};calendar.prototype.format=function(date){var y=date.getFullYear(),m=date.getMonth()+1,d=date.getDate();m=(m<10)?("0"+m):m;d=(d<10)?("0"+d):d;return y+"-"+m+"-"+d};J.Calendar=calendar})(J.$);(function($){var scrollCache={},index=1;J.Scroll=function(selector,opts){var scroll,scrollId,$el=$(selector),options={hScroll:false,bounce:false,lockDirection:true,useTransform:true,useTransition:false,checkDOMChanges:false,onBeforeScrollStart:function(e){var target=e.target;while(target.nodeType!=1){target=target.parentNode}if(target.tagName!="SELECT"&&target.tagName!="INPUT"&&target.tagName!="TEXTAREA"){e.preventDefault()}}};scrollId=$el.data("_jscroll_");if(scrollId&&scrollCache[scrollId]){scroll=scrollCache[scrollId];$.extend(scroll.scroller.options,opts);scroll.scroller.refresh();return scroll}else{scrollId="_jscroll_"+index++;$el.data("_jscroll_",scrollId);$.extend(options,opts);scroller=new iScroll($el[0],options);return scrollCache[scrollId]={scroller:scroller,destroy:function(){scroller.destroy();delete scrollCache[scrollId]}}}}})(J.$);(function($){function slider(selector,noDots){var afterSlide=function(){},beforeSlide=function(){return true},gestureStarted=false,index=0,speed=200,wrapper,dots,container,slides,slideNum,slideWidth,deltaX,autoPlay;var _this=this;if($.isPlainObject(selector)){wrapper=$(selector.selector);noDots=selector.noDots;beforeSlide=selector.onBeforeSlide||beforeSlide;afterSlide=selector.onAfterSlide||afterSlide;autoPlay=selector.autoPlay
}else{wrapper=$(selector)}var _init=function(){wrapper.css("overflow","hidden");container=wrapper.children().first();slides=container.children();slideNum=slides.length;slideWidth=wrapper.offset().width;container.css("width",slideNum*slideWidth);slides.css({"width":slideWidth,"float":"left"});if(!noDots){_initDots()}_slide(0,0);if(autoPlay){_autoPlay()}};var _autoPlay=function(){setTimeout(function(){if(index==slideNum-1){_slide(0)}else{_this.next()}_autoPlay()},3000)};var _initDots=function(){dots=wrapper.find(".dots");if(dots.length>0){dots.show()}else{var dotsWidth=slideNum*30+20+2;var html='<div class="dots"><ul>';for(var i=0;i<slideNum;i++){html+='<li index="'+i+'"';if(i==0){html+='class="active"'}html+='><a href="#"></a></li>'}html+="</ul></div>";wrapper.append(html);dots=wrapper.find(".dots");dots.children().css("width",dotsWidth+"px");dots.find("li").on("tap",function(){var index=$(this).attr("index");_slide(parseInt(index),speed)})}};var _slide=function(i,duration){duration=duration||speed;container.css({"-webkit-transition-duration":duration+"ms","-webkit-transform":"translate3D("+-(i*slideWidth)+"px,0,0)"});if(index!=i){index=i;if(dots){$(dots.find("li").get(index)).addClass("active").siblings().removeClass("active")}afterSlide(index)}};var _bindEvents=function(){container.on("touchstart",_touchStart,false);container.on("touchmove",_touchMove,false);container.on("touchend",_touchEnd,false)};var _touchStart=function(event){var e=event.touches[0];start={pageX:e.pageX,pageY:e.pageY,time:Number(new Date())};isScrolling=undefined;deltaX=0;container[0].style.webkitTransitionDuration=0;gestureStarted=true};var _touchMove=function(event){if(!gestureStarted){return}var e=event.touches[0];deltaX=e.pageX-start.pageX;if(typeof isScrolling=="undefined"){isScrolling=Math.abs(deltaX)<Math.abs(e.pageY-start.pageY)}if(!isScrolling){event.preventDefault();var isPastBounds=!index&&deltaX>0||index==slideNum-1&&deltaX<0;if(isPastBounds){return}var pos=(deltaX-index*slideWidth);
container[0].style.webkitTransform="translate3D("+pos+"px,0,0)"}};var _touchEnd=function(e){var isValidSlide=(Number(new Date())-start.time<250&&Math.abs(deltaX)>20)||Math.abs(deltaX)>slideWidth/3;var isPastBounds=!index&&deltaX>0||index==slideNum-1&&deltaX<0;if(!isScrolling){if(beforeSlide(index,deltaX)){_slide(index+(isValidSlide&&!isPastBounds?(deltaX<0?1:-1):0),speed)}else{_slide(index)}}gestureStarted=false};_init();_bindEvents();this.refresh=function(){container.attr("style","");_init()};this.prev=function(){if(index){_slide(index-1,speed)}};this.next=function(){if(index<slideNum-1){_slide(index+1,speed)}};this.index=function(i){_slide(i)}}J.Slider=slider})(J.$);(function($){var refreshCache={},index=1;function Refresh(selector,type,callback){var iscroll,scroller,refreshEl,iconEl,labelEl,topOffset,isPullDown,options={selector:undefined,type:"pullDown",minPullHeight:10,pullText:"????...",releaseText:"??????...",refreshText:"???...",refreshTip:false,onPullIcon:"arrow-down-2",onReleaseIcon:"icon-reverse",onRefreshIcon:"spinner",callback:undefined};if(typeof selector==="object"){$.extend(options,selector)}else{options.selector=selector;options.type=type;options.callback=callback;if(type==="pullUp"){$.extend(options,{pullText:"??????...",releaseText:"???????...",refreshText:"???...",onPullIcon:"arrow-up-3"})}}isPullDown=options.type==="pullDown"?true:false;var _init=function(opts){scroller=$(opts.selector).children()[0];var refreshTpl='<div class="refresh-container"><span class="refresh-icon icon '+opts.onPullIcon+'"></span><span class="refresh-label">'+opts.pullText+"</span>"+(opts.refreshTip?'<div class="refresh-tip">'+opts.refreshTip+"</div>":"")+"</div>";if(isPullDown){refreshEl=$(refreshTpl).prependTo(scroller)}else{refreshEl=$(refreshTpl).appendTo(scroller)}topOffset=refreshEl.height();iconEl=refreshEl.find(".refresh-icon");labelEl=refreshEl.find(".refresh-label")};var _excuteScroll=function(opts){return J.Scroll(opts.selector,{topOffset:isPullDown?topOffset:0,bounce:true,onScrollMove:function(){if(this.y>opts.minPullHeight&&isPullDown&&!iconEl.hasClass(opts.onReleaseIcon)){iconEl.addClass(opts.onReleaseIcon);
labelEl.html(opts.releaseText);this.minScrollY=0}else{if(this.y<opts.minPullHeight&&isPullDown&&iconEl.hasClass(opts.onReleaseIcon)){iconEl.removeClass(opts.onReleaseIcon);labelEl.html(opts.pullText);this.minScrollY=-topOffset}else{if(this.y<(this.maxScrollY-opts.minPullHeight)&&!isPullDown&&!iconEl.hasClass(opts.onReleaseIcon)){iconEl.addClass(opts.onReleaseIcon);labelEl.html(opts.releaseText);this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+opts.minPullHeight)&&!isPullDown&&iconEl.hasClass(opts.onReleaseIcon)){iconEl.removeClass(opts.onReleaseIcon);labelEl.html(opts.pullText);this.maxScrollY=topOffset}}}}},onScrollEnd:function(){if(iconEl.hasClass(opts.onReleaseIcon)){iconEl.removeClass(opts.onReleaseIcon).removeClass(opts.onPullIcon).addClass(opts.onRefreshIcon);labelEl.html(opts.refreshText);var _this=this;setTimeout(function(){opts.callback.call(_this)},1)}},onRefresh:function(){iconEl.removeClass(opts.onRefreshIcon).addClass(opts.onPullIcon);labelEl.html(opts.pullText)}})};_init(options);iscroll=_excuteScroll(options);return iscroll}J.Refresh=function(selector,type,callback){var el,jRefreshId;if(selector.selector){el=$(selector.selector)}else{el=$(selector)}jRefreshId=el.data("_jrefresh_");if(jRefreshId&&refreshCache[jRefreshId]){return refreshCache[jRefreshId]}else{jRefreshId="_jrefresh_"+index++;el.data("_jrefresh_",jRefreshId);var refresh=new Refresh(selector,type,callback);return refreshCache[jRefreshId]={scroller:refresh.scroller,destroy:function(){delete refreshCache[jRefreshId];refresh.scroller.destroy();$(".refresh-container",selector).remove()}}}}})(J.$);
(function($){try{document.createEvent("TouchEvent")}catch(e){var _fakeCallbacks={},eventmap={"touchstart":"mousedown","touchend":"mouseup","touchmove":"mousemove"};function touch2mouse(type,callback,context){if((typeof type)=="object"){return[type]}var p=type.match(/([^.]*)(\..*|$)/),orig=p[0],type=p[1],extra=p[2],mappedevent=eventmap[type];result=[(mappedevent||type)+extra];if(arguments.length>1){if(mappedevent){callback=fakeTouches(type,callback,context)}result.push(callback)}return result}function fakeTouches(type,callback,context){return _fakeCallbacks[callback]=function(event){if(event.liveFired){context=this}if(event.button){return false}event.touches=[{length:1,clientX:event.clientX,clientY:event.clienty,pageX:event.pageX,pageY:event.pageY,screenX:event.screenX,screenY:event.screenY,target:event.target}];event.touchtype=type;return callback.apply(context,[event])}}var _bind=$.fn.bind;$.fn.bind=function(event,callback){return _bind.apply(this,touch2mouse(event,callback,this))};var _unbind=$.fn.unbind;$.fn.unbind=function(event,callback){if(!event){_unbind.apply(this);return}var result=_unbind.apply(this,touch2mouse(event).concat([_fakeCallbacks[callback]||callback]));delete (_fakeCallbacks[callback]);return result};var _one=$.fn.one;$.fn.one=function(event,callback){return _one.apply(this,touch2mouse(event,callback,this))};var _delegate=$.fn.delegate;$.fn.delegate=function(selector,event,callback){return _delegate.apply(this,[selector].concat(touch2mouse(event,callback,this)))};var _undelegate=$.fn.undelegate;$.fn.undelegate=function(selector,event,callback){var result=_undelegate.apply(this,[selector].concat(touch2mouse(event),[_fakeCallbacks[callback]||callback]));delete (_fakeCallbacks[callback]);return result};var _live=$.fn.live;$.fn.live=function(event,callback){return _live.apply(this,touch2mouse(event,callback,this))};var _die=$.fn.die;$.fn.die=function(event,callback){var result=_die.apply(this,touch2mouse(event).concat([_fakeCallbacks[callback]||callback]));
delete (_fakeCallbacks[callback]);return result};var _trigger=$.fn.trigger;$.fn.trigger=function(event,data){return _trigger.apply(this,touch2mouse(event).concat([data]))};var _triggerHandler=$.fn.triggerHandler;$.fn.triggerHandler=function(event,data){return _triggerHandler.apply(this,touch2mouse(event).concat([data]))}}})(Zepto);
/*!
 * iScroll v4.2.5 ~ Copyright (c) 2012 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */
(function(window,doc){var m=Math,dummyStyle=doc.createElement("div").style,vendor=(function(){var vendors="t,webkitT,MozT,msT,OT".split(","),t,i=0,l=vendors.length;for(;i<l;i++){t=vendors[i]+"ransform";if(t in dummyStyle){return vendors[i].substr(0,vendors[i].length-1)}}return false})(),cssVendor=vendor?"-"+vendor.toLowerCase()+"-":"",transform=prefixStyle("transform"),transitionProperty=prefixStyle("transitionProperty"),transitionDuration=prefixStyle("transitionDuration"),transformOrigin=prefixStyle("transformOrigin"),transitionTimingFunction=prefixStyle("transitionTimingFunction"),transitionDelay=prefixStyle("transitionDelay"),isAndroid=(/android/gi).test(navigator.appVersion),isIDevice=(/iphone|ipad/gi).test(navigator.appVersion),isTouchPad=(/hp-tablet/gi).test(navigator.appVersion),has3d=prefixStyle("perspective") in dummyStyle,hasTouch="ontouchstart" in window&&!isTouchPad,hasTransform=vendor!==false,hasTransitionEnd=prefixStyle("transition") in dummyStyle,RESIZE_EV="onorientationchange" in window?"orientationchange":"resize",START_EV=hasTouch?"touchstart":"mousedown",MOVE_EV=hasTouch?"touchmove":"mousemove",END_EV=hasTouch?"touchend":"mouseup",CANCEL_EV=hasTouch?"touchcancel":"mouseup",TRNEND_EV=(function(){if(vendor===false){return false}var transitionEnd={"":"transitionend","webkit":"webkitTransitionEnd","Moz":"transitionend","O":"otransitionend","ms":"MSTransitionEnd"};return transitionEnd[vendor]})(),nextFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return setTimeout(callback,1)}})(),cancelFrame=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout
})(),translateZ=has3d?" translateZ(0)":"",iScroll=function(el,options){var that=this,i;that.wrapper=typeof el=="object"?el:doc.getElementById(el);that.wrapper.style.overflow="hidden";that.scroller=that.wrapper.children[0];that.options={hScroll:true,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:false,topOffset:0,checkDOMChanges:false,handleClick:true,hScrollbar:true,vScrollbar:true,fixedScrollbar:isAndroid,hideScrollbar:isIDevice,fadeScrollbar:isIDevice&&has3d,scrollbarClass:"",zoom:false,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:false,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(i in options){that.options[i]=options[i]}that.x=that.options.x;that.y=that.options.y;that.options.useTransform=hasTransform&&that.options.useTransform;that.options.hScrollbar=that.options.hScroll&&that.options.hScrollbar;that.options.vScrollbar=that.options.vScroll&&that.options.vScrollbar;that.options.zoom=that.options.useTransform&&that.options.zoom;that.options.useTransition=hasTransitionEnd&&that.options.useTransition;if(that.options.zoom&&isAndroid){translateZ=""}that.scroller.style[transitionProperty]=that.options.useTransform?cssVendor+"transform":"top left";that.scroller.style[transitionDuration]="0";that.scroller.style[transformOrigin]="0 0";if(that.options.useTransition){that.scroller.style[transitionTimingFunction]="cubic-bezier(0.33,0.66,0.66,1)"}if(that.options.useTransform){that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px)"+translateZ}else{that.scroller.style.cssText+=";position:absolute;top:"+that.y+"px;left:"+that.x+"px"}if(that.options.useTransition){that.options.fixedScrollbar=true}that.refresh();that._bind(RESIZE_EV,window);that._bind(START_EV);if(!hasTouch){if(that.options.wheelAction!="none"){that._bind("DOMMouseScroll");
that._bind("mousewheel")}}if(that.options.checkDOMChanges){that.checkDOMTime=setInterval(function(){that._checkDOMChanges()},500)}};iScroll.prototype={enabled:true,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var that=this;switch(e.type){case START_EV:if(!hasTouch&&e.button!==0){return}that._start(e);break;case MOVE_EV:that._move(e);break;case END_EV:case CANCEL_EV:that._end(e);break;case RESIZE_EV:that._resize();break;case"DOMMouseScroll":case"mousewheel":that._wheel(e);break;case TRNEND_EV:that._transitionEnd(e);break}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||(this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)){return}this.refresh()},_scrollbar:function(dir){var that=this,bar;if(!that[dir+"Scrollbar"]){if(that[dir+"ScrollbarWrapper"]){if(hasTransform){that[dir+"ScrollbarIndicator"].style[transform]=""}that[dir+"ScrollbarWrapper"].parentNode.removeChild(that[dir+"ScrollbarWrapper"]);that[dir+"ScrollbarWrapper"]=null;that[dir+"ScrollbarIndicator"]=null}return}if(!that[dir+"ScrollbarWrapper"]){bar=doc.createElement("div");if(that.options.scrollbarClass){bar.className=that.options.scrollbarClass+dir.toUpperCase()}else{bar.style.cssText="position:absolute;z-index:100;"+(dir=="h"?"height:7px;bottom:1px;left:2px;right:"+(that.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(that.hScrollbar?"7":"2")+"px;top:2px;right:1px")}bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:opacity;"+cssVendor+"transition-duration:"+(that.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(that.options.hideScrollbar?"0":"1");that.wrapper.appendChild(bar);that[dir+"ScrollbarWrapper"]=bar;bar=doc.createElement("div");if(!that.options.scrollbarClass){bar.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+cssVendor+"background-clip:padding-box;"+cssVendor+"box-sizing:border-box;"+(dir=="h"?"height:100%":"width:100%")+";"+cssVendor+"border-radius:3px;border-radius:3px"
}bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:"+cssVendor+"transform;"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+cssVendor+"transition-duration:0;"+cssVendor+"transform: translate(0,0)"+translateZ;if(that.options.useTransition){bar.style.cssText+=";"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"}that[dir+"ScrollbarWrapper"].appendChild(bar);that[dir+"ScrollbarIndicator"]=bar}if(dir=="h"){that.hScrollbarSize=that.hScrollbarWrapper.clientWidth;that.hScrollbarIndicatorSize=m.max(m.round(that.hScrollbarSize*that.hScrollbarSize/that.scrollerW),8);that.hScrollbarIndicator.style.width=that.hScrollbarIndicatorSize+"px";that.hScrollbarMaxScroll=that.hScrollbarSize-that.hScrollbarIndicatorSize;that.hScrollbarProp=that.hScrollbarMaxScroll/that.maxScrollX}else{that.vScrollbarSize=that.vScrollbarWrapper.clientHeight;that.vScrollbarIndicatorSize=m.max(m.round(that.vScrollbarSize*that.vScrollbarSize/that.scrollerH),8);that.vScrollbarIndicator.style.height=that.vScrollbarIndicatorSize+"px";that.vScrollbarMaxScroll=that.vScrollbarSize-that.vScrollbarIndicatorSize;that.vScrollbarProp=that.vScrollbarMaxScroll/that.maxScrollY}that._scrollbarPos(dir,true)},_resize:function(){var that=this;setTimeout(function(){that.refresh()},isAndroid?200:0)},_pos:function(x,y){if(this.zoomed){return}x=this.hScroll?x:0;y=this.vScroll?y:0;if(this.options.useTransform){this.scroller.style[transform]="translate("+x+"px,"+y+"px) scale("+this.scale+")"+translateZ}else{x=m.round(x);y=m.round(y);this.scroller.style.left=x+"px";this.scroller.style.top=y+"px"}this.x=x;this.y=y;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(dir,hidden){var that=this,pos=dir=="h"?that.x:that.y,size;if(!that[dir+"Scrollbar"]){return}pos=that[dir+"ScrollbarProp"]*pos;if(pos<0){if(!that.options.fixedScrollbar){size=that[dir+"ScrollbarIndicatorSize"]+m.round(pos*3);if(size<8){size=8}that[dir+"ScrollbarIndicator"].style[dir=="h"?"width":"height"]=size+"px"
}pos=0}else{if(pos>that[dir+"ScrollbarMaxScroll"]){if(!that.options.fixedScrollbar){size=that[dir+"ScrollbarIndicatorSize"]-m.round((pos-that[dir+"ScrollbarMaxScroll"])*3);if(size<8){size=8}that[dir+"ScrollbarIndicator"].style[dir=="h"?"width":"height"]=size+"px";pos=that[dir+"ScrollbarMaxScroll"]+(that[dir+"ScrollbarIndicatorSize"]-size)}else{pos=that[dir+"ScrollbarMaxScroll"]}}}that[dir+"ScrollbarWrapper"].style[transitionDelay]="0";that[dir+"ScrollbarWrapper"].style.opacity=hidden&&that.options.hideScrollbar?"0":"1";that[dir+"ScrollbarIndicator"].style[transform]="translate("+(dir=="h"?pos+"px,0)":"0,"+pos+"px)")+translateZ},_start:function(e){var that=this,point=hasTouch?e.touches[0]:e,matrix,x,y,c1,c2;if(!that.enabled){return}if(that.options.onBeforeScrollStart){that.options.onBeforeScrollStart.call(that,e)}if(that.options.useTransition||that.options.zoom){that._transitionTime(0)}that.moved=false;that.animating=false;that.zoomed=false;that.distX=0;that.distY=0;that.absDistX=0;that.absDistY=0;that.dirX=0;that.dirY=0;if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDistStart=m.sqrt(c1*c1+c2*c2);that.originX=m.abs(e.touches[0].pageX+e.touches[1].pageX-that.wrapperOffsetLeft*2)/2-that.x;that.originY=m.abs(e.touches[0].pageY+e.touches[1].pageY-that.wrapperOffsetTop*2)/2-that.y;if(that.options.onZoomStart){that.options.onZoomStart.call(that,e)}}if(that.options.momentum){if(that.options.useTransform){matrix=getComputedStyle(that.scroller,null)[transform].replace(/[^0-9\-.,]/g,"").split(",");x=+(matrix[12]||matrix[4]);y=+(matrix[13]||matrix[5])}else{x=+getComputedStyle(that.scroller,null).left.replace(/[^0-9-]/g,"");y=+getComputedStyle(that.scroller,null).top.replace(/[^0-9-]/g,"")}if(x!=that.x||y!=that.y){if(that.options.useTransition){that._unbind(TRNEND_EV)}else{cancelFrame(that.aniTime)}that.steps=[];that._pos(x,y);if(that.options.onScrollEnd){that.options.onScrollEnd.call(that)
}}}that.absStartX=that.x;that.absStartY=that.y;that.startX=that.x;that.startY=that.y;that.pointX=point.pageX;that.pointY=point.pageY;that.startTime=e.timeStamp||Date.now();if(that.options.onScrollStart){that.options.onScrollStart.call(that,e)}that._bind(MOVE_EV,window);that._bind(END_EV,window);that._bind(CANCEL_EV,window)},_move:function(e){var that=this,point=hasTouch?e.touches[0]:e,deltaX=point.pageX-that.pointX,deltaY=point.pageY-that.pointY,newX=that.x+deltaX,newY=that.y+deltaY,c1,c2,scale,timestamp=e.timeStamp||Date.now();if(that.options.onBeforeScrollMove){that.options.onBeforeScrollMove.call(that,e)}if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDist=m.sqrt(c1*c1+c2*c2);that.zoomed=true;scale=1/that.touchesDistStart*that.touchesDist*this.scale;if(scale<that.options.zoomMin){scale=0.5*that.options.zoomMin*Math.pow(2,scale/that.options.zoomMin)}else{if(scale>that.options.zoomMax){scale=2*that.options.zoomMax*Math.pow(0.5,that.options.zoomMax/scale)}}that.lastScale=scale/this.scale;newX=this.originX-this.originX*that.lastScale+this.x;newY=this.originY-this.originY*that.lastScale+this.y;this.scroller.style[transform]="translate("+newX+"px,"+newY+"px) scale("+scale+")"+translateZ;if(that.options.onZoom){that.options.onZoom.call(that,e)}return}that.pointX=point.pageX;that.pointY=point.pageY;if(newX>0||newX<that.maxScrollX){newX=that.options.bounce?that.x+(deltaX/2):newX>=0||that.maxScrollX>=0?0:that.maxScrollX}if(newY>that.minScrollY||newY<that.maxScrollY){newY=that.options.bounce?that.y+(deltaY/2):newY>=that.minScrollY||that.maxScrollY>=0?that.minScrollY:that.maxScrollY}that.distX+=deltaX;that.distY+=deltaY;that.absDistX=m.abs(that.distX);that.absDistY=m.abs(that.distY);if(that.absDistX<6&&that.absDistY<6){return}if(that.options.lockDirection){if(that.absDistX>that.absDistY+5){newY=that.y;deltaY=0}else{if(that.absDistY>that.absDistX+5){newX=that.x;deltaX=0
}}}that.moved=true;that._pos(newX,newY);that.dirX=deltaX>0?-1:deltaX<0?1:0;that.dirY=deltaY>0?-1:deltaY<0?1:0;if(timestamp-that.startTime>300){that.startTime=timestamp;that.startX=that.x;that.startY=that.y}if(that.options.onScrollMove){that.options.onScrollMove.call(that,e)}},_end:function(e){if(hasTouch&&e.touches.length!==0){return}var that=this,point=hasTouch?e.changedTouches[0]:e,target,ev,momentumX={dist:0,time:0},momentumY={dist:0,time:0},duration=(e.timeStamp||Date.now())-that.startTime,newPosX=that.x,newPosY=that.y,distX,distY,newDuration,snap,scale;that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(that.options.onBeforeScrollEnd){that.options.onBeforeScrollEnd.call(that,e)}if(that.zoomed){scale=that.scale*that.lastScale;scale=Math.max(that.options.zoomMin,scale);scale=Math.min(that.options.zoomMax,scale);that.lastScale=scale/that.scale;that.scale=scale;that.x=that.originX-that.originX*that.lastScale+that.x;that.y=that.originY-that.originY*that.lastScale+that.y;that.scroller.style[transitionDuration]="200ms";that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+that.scale+")"+translateZ;that.zoomed=false;that.refresh();if(that.options.onZoomEnd){that.options.onZoomEnd.call(that,e)}return}if(!that.moved){if(hasTouch){if(that.doubleTapTimer&&that.options.zoom){clearTimeout(that.doubleTapTimer);that.doubleTapTimer=null;if(that.options.onZoomStart){that.options.onZoomStart.call(that,e)}that.zoom(that.pointX,that.pointY,that.scale==1?that.options.doubleTapZoom:1);if(that.options.onZoomEnd){setTimeout(function(){that.options.onZoomEnd.call(that,e)},200)}}else{if(this.options.handleClick){that.doubleTapTimer=setTimeout(function(){that.doubleTapTimer=null;target=point.target;while(target.nodeType!=1){target=target.parentNode}if(target.tagName!="SELECT"&&target.tagName!="INPUT"&&target.tagName!="TEXTAREA"){ev=doc.createEvent("MouseEvents");ev.initMouseEvent("click",true,true,e.view,1,point.screenX,point.screenY,point.clientX,point.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);
ev._fake=true;target.dispatchEvent(ev)}},that.options.zoom?250:0)}}}that._resetPos(400);if(that.options.onTouchEnd){that.options.onTouchEnd.call(that,e)}return}if(duration<300&&that.options.momentum){momentumX=newPosX?that._momentum(newPosX-that.startX,duration,-that.x,that.scrollerW-that.wrapperW+that.x,that.options.bounce?that.wrapperW:0):momentumX;momentumY=newPosY?that._momentum(newPosY-that.startY,duration,-that.y,(that.maxScrollY<0?that.scrollerH-that.wrapperH+that.y-that.minScrollY:0),that.options.bounce?that.wrapperH:0):momentumY;newPosX=that.x+momentumX.dist;newPosY=that.y+momentumY.dist;if((that.x>0&&newPosX>0)||(that.x<that.maxScrollX&&newPosX<that.maxScrollX)){momentumX={dist:0,time:0}}if((that.y>that.minScrollY&&newPosY>that.minScrollY)||(that.y<that.maxScrollY&&newPosY<that.maxScrollY)){momentumY={dist:0,time:0}}}if(momentumX.dist||momentumY.dist){newDuration=m.max(m.max(momentumX.time,momentumY.time),10);if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold){that.scrollTo(that.absStartX,that.absStartY,200)}else{snap=that._snap(newPosX,newPosY);newPosX=snap.x;newPosY=snap.y;newDuration=m.max(snap.time,newDuration)}}that.scrollTo(m.round(newPosX),m.round(newPosY),newDuration);if(that.options.onTouchEnd){that.options.onTouchEnd.call(that,e)}return}if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold){that.scrollTo(that.absStartX,that.absStartY,200)}else{snap=that._snap(that.x,that.y);if(snap.x!=that.x||snap.y!=that.y){that.scrollTo(snap.x,snap.y,snap.time)}}if(that.options.onTouchEnd){that.options.onTouchEnd.call(that,e)}return}that._resetPos(200);if(that.options.onTouchEnd){that.options.onTouchEnd.call(that,e)}},_resetPos:function(time){var that=this,resetX=that.x>=0?0:that.x<that.maxScrollX?that.maxScrollX:that.x,resetY=that.y>=that.minScrollY||that.maxScrollY>0?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;
if(resetX==that.x&&resetY==that.y){if(that.moved){that.moved=false;if(that.options.onScrollEnd){that.options.onScrollEnd.call(that)}}if(that.hScrollbar&&that.options.hideScrollbar){if(vendor=="webkit"){that.hScrollbarWrapper.style[transitionDelay]="300ms"}that.hScrollbarWrapper.style.opacity="0"}if(that.vScrollbar&&that.options.hideScrollbar){if(vendor=="webkit"){that.vScrollbarWrapper.style[transitionDelay]="300ms"}that.vScrollbarWrapper.style.opacity="0"}return}that.scrollTo(resetX,resetY,time||0)},_wheel:function(e){var that=this,wheelDeltaX,wheelDeltaY,deltaX,deltaY,deltaScale;if("wheelDeltaX" in e){wheelDeltaX=e.wheelDeltaX/12;wheelDeltaY=e.wheelDeltaY/12}else{if("wheelDelta" in e){wheelDeltaX=wheelDeltaY=e.wheelDelta/12}else{if("detail" in e){wheelDeltaX=wheelDeltaY=-e.detail*3}else{return}}}if(that.options.wheelAction=="zoom"){deltaScale=that.scale*Math.pow(2,1/3*(wheelDeltaY?wheelDeltaY/Math.abs(wheelDeltaY):0));if(deltaScale<that.options.zoomMin){deltaScale=that.options.zoomMin}if(deltaScale>that.options.zoomMax){deltaScale=that.options.zoomMax}if(deltaScale!=that.scale){if(!that.wheelZoomCount&&that.options.onZoomStart){that.options.onZoomStart.call(that,e)}that.wheelZoomCount++;that.zoom(e.pageX,e.pageY,deltaScale,400);setTimeout(function(){that.wheelZoomCount--;if(!that.wheelZoomCount&&that.options.onZoomEnd){that.options.onZoomEnd.call(that,e)}},400)}return}deltaX=that.x+wheelDeltaX;deltaY=that.y+wheelDeltaY;if(deltaX>0){deltaX=0}else{if(deltaX<that.maxScrollX){deltaX=that.maxScrollX}}if(deltaY>that.minScrollY){deltaY=that.minScrollY}else{if(deltaY<that.maxScrollY){deltaY=that.maxScrollY}}if(that.maxScrollY<0){that.scrollTo(deltaX,deltaY,0)}},_transitionEnd:function(e){var that=this;if(e.target!=that.scroller){return}that._unbind(TRNEND_EV);that._startAni()},_startAni:function(){var that=this,startX=that.x,startY=that.y,startTime=Date.now(),step,easeOut,animate;if(that.animating){return}if(!that.steps.length){that._resetPos(400);return}step=that.steps.shift();
if(step.x==startX&&step.y==startY){step.time=0}that.animating=true;that.moved=true;if(that.options.useTransition){that._transitionTime(step.time);that._pos(step.x,step.y);that.animating=false;if(step.time){that._bind(TRNEND_EV)}else{that._resetPos(0)}return}animate=function(){var now=Date.now(),newX,newY;if(now>=startTime+step.time){that._pos(step.x,step.y);that.animating=false;if(that.options.onAnimationEnd){that.options.onAnimationEnd.call(that)}that._startAni();return}now=(now-startTime)/step.time-1;easeOut=m.sqrt(1-now*now);newX=(step.x-startX)*easeOut+startX;newY=(step.y-startY)*easeOut+startY;that._pos(newX,newY);if(that.animating){that.aniTime=nextFrame(animate)}};animate()},_transitionTime:function(time){time+="ms";this.scroller.style[transitionDuration]=time;if(this.hScrollbar){this.hScrollbarIndicator.style[transitionDuration]=time}if(this.vScrollbar){this.vScrollbarIndicator.style[transitionDuration]=time}},_momentum:function(dist,time,maxDistUpper,maxDistLower,size){var deceleration=0.0006,speed=m.abs(dist)/time,newDist=(speed*speed)/(2*deceleration),newTime=0,outsideDist=0;if(dist>0&&newDist>maxDistUpper){outsideDist=size/(6/(newDist/speed*deceleration));maxDistUpper=maxDistUpper+outsideDist;speed=speed*maxDistUpper/newDist;newDist=maxDistUpper}else{if(dist<0&&newDist>maxDistLower){outsideDist=size/(6/(newDist/speed*deceleration));maxDistLower=maxDistLower+outsideDist;speed=speed*maxDistLower/newDist;newDist=maxDistLower}}newDist=newDist*(dist<0?-1:1);newTime=speed/deceleration;return{dist:newDist,time:m.round(newTime)}},_offset:function(el){var left=-el.offsetLeft,top=-el.offsetTop;while(el=el.offsetParent){left-=el.offsetLeft;top-=el.offsetTop}if(el!=this.wrapper){left*=this.scale;top*=this.scale}return{left:left,top:top}},_snap:function(x,y){var that=this,i,l,page,time,sizeX,sizeY;page=that.pagesX.length-1;for(i=0,l=that.pagesX.length;i<l;i++){if(x>=that.pagesX[i]){page=i;break}}if(page==that.currPageX&&page>0&&that.dirX<0){page--}x=that.pagesX[page];
sizeX=m.abs(x-that.pagesX[that.currPageX]);sizeX=sizeX?m.abs(that.x-x)/sizeX*500:0;that.currPageX=page;page=that.pagesY.length-1;for(i=0;i<page;i++){if(y>=that.pagesY[i]){page=i;break}}if(page==that.currPageY&&page>0&&that.dirY<0){page--}y=that.pagesY[page];sizeY=m.abs(y-that.pagesY[that.currPageY]);sizeY=sizeY?m.abs(that.y-y)/sizeY*500:0;that.currPageY=page;time=m.round(m.max(sizeX,sizeY))||200;return{x:x,y:y,time:time}},_bind:function(type,el,bubble){(el||this.scroller).addEventListener(type,this,!!bubble)},_unbind:function(type,el,bubble){(el||this.scroller).removeEventListener(type,this,!!bubble)},destroy:function(){var that=this;that.scroller.style[transform]="";that.hScrollbar=false;that.vScrollbar=false;that._scrollbar("h");that._scrollbar("v");that._unbind(RESIZE_EV,window);that._unbind(START_EV);that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(!that.options.hasTouch){that._unbind("DOMMouseScroll");that._unbind("mousewheel")}if(that.options.useTransition){that._unbind(TRNEND_EV)}if(that.options.checkDOMChanges){clearInterval(that.checkDOMTime)}if(that.options.onDestroy){that.options.onDestroy.call(that)}},refresh:function(){var that=this,offset,i,l,els,pos=0,page=0;if(that.scale<that.options.zoomMin){that.scale=that.options.zoomMin}that.wrapperW=that.wrapper.clientWidth||1;that.wrapperH=that.wrapper.clientHeight||1;that.minScrollY=-that.options.topOffset||0;that.scrollerW=m.round(that.scroller.offsetWidth*that.scale);that.scrollerH=m.round((that.scroller.offsetHeight+that.minScrollY)*that.scale);that.maxScrollX=that.wrapperW-that.scrollerW;that.maxScrollY=that.wrapperH-that.scrollerH+that.minScrollY;that.dirX=0;that.dirY=0;if(that.options.onRefresh){that.options.onRefresh.call(that)}that.hScroll=that.options.hScroll&&that.maxScrollX<0;that.vScroll=that.options.vScroll&&(!that.options.bounceLock&&!that.hScroll||that.scrollerH>that.wrapperH);that.hScrollbar=that.hScroll&&that.options.hScrollbar;that.vScrollbar=that.vScroll&&that.options.vScrollbar&&that.scrollerH>that.wrapperH;
offset=that._offset(that.wrapper);that.wrapperOffsetLeft=-offset.left;that.wrapperOffsetTop=-offset.top;if(typeof that.options.snap=="string"){that.pagesX=[];that.pagesY=[];els=that.scroller.querySelectorAll(that.options.snap);for(i=0,l=els.length;i<l;i++){pos=that._offset(els[i]);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;that.pagesX[i]=pos.left<that.maxScrollX?that.maxScrollX:pos.left*that.scale;that.pagesY[i]=pos.top<that.maxScrollY?that.maxScrollY:pos.top*that.scale}}else{if(that.options.snap){that.pagesX=[];while(pos>=that.maxScrollX){that.pagesX[page]=pos;pos=pos-that.wrapperW;page++}if(that.maxScrollX%that.wrapperW){that.pagesX[that.pagesX.length]=that.maxScrollX-that.pagesX[that.pagesX.length-1]+that.pagesX[that.pagesX.length-1]}pos=0;page=0;that.pagesY=[];while(pos>=that.maxScrollY){that.pagesY[page]=pos;pos=pos-that.wrapperH;page++}if(that.maxScrollY%that.wrapperH){that.pagesY[that.pagesY.length]=that.maxScrollY-that.pagesY[that.pagesY.length-1]+that.pagesY[that.pagesY.length-1]}}}that._scrollbar("h");that._scrollbar("v");if(!that.zoomed){that.scroller.style[transitionDuration]="0";that._resetPos(400)}},scrollTo:function(x,y,time,relative){var that=this,step=x,i,l;that.stop();if(!step.length){step=[{x:x,y:y,time:time,relative:relative}]}for(i=0,l=step.length;i<l;i++){if(step[i].relative){step[i].x=that.x-step[i].x;step[i].y=that.y-step[i].y}that.steps.push({x:step[i].x,y:step[i].y,time:step[i].time||0})}that._startAni()},scrollToElement:function(el,time){var that=this,pos;el=el.nodeType?el:that.scroller.querySelector(el);if(!el){return}pos=that._offset(el);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;pos.left=pos.left>0?0:pos.left<that.maxScrollX?that.maxScrollX:pos.left;pos.top=pos.top>that.minScrollY?that.minScrollY:pos.top<that.maxScrollY?that.maxScrollY:pos.top;time=time===undefined?m.max(m.abs(pos.left)*2,m.abs(pos.top)*2):time;that.scrollTo(pos.left,pos.top,time)},scrollToPage:function(pageX,pageY,time){var that=this,x,y;
time=time===undefined?400:time;if(that.options.onScrollStart){that.options.onScrollStart.call(that)}if(that.options.snap){pageX=pageX=="next"?that.currPageX+1:pageX=="prev"?that.currPageX-1:pageX;pageY=pageY=="next"?that.currPageY+1:pageY=="prev"?that.currPageY-1:pageY;pageX=pageX<0?0:pageX>that.pagesX.length-1?that.pagesX.length-1:pageX;pageY=pageY<0?0:pageY>that.pagesY.length-1?that.pagesY.length-1:pageY;that.currPageX=pageX;that.currPageY=pageY;x=that.pagesX[pageX];y=that.pagesY[pageY]}else{x=-that.wrapperW*pageX;y=-that.wrapperH*pageY;if(x<that.maxScrollX){x=that.maxScrollX}if(y<that.maxScrollY){y=that.maxScrollY}}that.scrollTo(x,y,time)},disable:function(){this.stop();this._resetPos(0);this.enabled=false;this._unbind(MOVE_EV,window);this._unbind(END_EV,window);this._unbind(CANCEL_EV,window)},enable:function(){this.enabled=true},stop:function(){if(this.options.useTransition){this._unbind(TRNEND_EV)}else{cancelFrame(this.aniTime)}this.steps=[];this.moved=false;this.animating=false},zoom:function(x,y,scale,time){var that=this,relScale=scale/that.scale;if(!that.options.useTransform){return}that.zoomed=true;time=time===undefined?200:time;x=x-that.wrapperOffsetLeft-that.x;y=y-that.wrapperOffsetTop-that.y;that.x=x-x*relScale+that.x;that.y=y-y*relScale+that.y;that.scale=scale;that.refresh();that.x=that.x>0?0:that.x<that.maxScrollX?that.maxScrollX:that.x;that.y=that.y>that.minScrollY?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;that.scroller.style[transitionDuration]=time+"ms";that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+scale+")"+translateZ;that.zoomed=false},isReady:function(){return !this.moved&&!this.zoomed&&!this.animating}};function prefixStyle(style){if(vendor===""){return style}style=style.charAt(0).toUpperCase()+style.substr(1);return vendor+style}dummyStyle=null;if(typeof exports!=="undefined"){exports.iScroll=iScroll}else{window.iScroll=iScroll}})(window,document);
/*!artTemplate - Template Engine*/
var template=function(a,b){return template["object"==typeof b?"render":"compile"].apply(template,arguments)};(function(a,b){a.version="2.0.1",a.openTag="<%",a.closeTag="%>",a.isEscape=!0,a.isCompress=!1,a.parser=null,a.render=function(a,b){var c=d(a);return void 0===c?e({id:a,name:"Render Error",message:"No Template"}):c(b)},a.compile=function(b,d){function l(c){try{return new j(c)+""}catch(f){return h?(f.id=b||d,f.name="Render Error",f.source=d,e(f)):a.compile(b,d,!0)(c)}}var g=arguments,h=g[2],i="anonymous";"string"!=typeof d&&(h=g[1],d=g[0],b=i);try{var j=f(d,h)}catch(k){return k.id=b||d,k.name="Syntax Error",e(k)}return l.prototype=j.prototype,l.toString=function(){return""+j},b!==i&&(c[b]=l),l},a.helper=function(b,c){a.prototype[b]=c},a.onerror=function(a){var c="[template]:\n"+a.id+"\n\n[name]:\n"+a.name;a.message&&(c+="\n\n[message]:\n"+a.message),a.line&&(c+="\n\n[line]:\n"+a.line,c+="\n\n[source]:\n"+a.source.split(/\n/)[a.line-1].replace(/^[\s\t]+/,"")),a.temp&&(c+="\n\n[temp]:\n"+a.temp),b.console&&console.error(c)};var c={},d=function(d){var e=c[d];if(void 0===e&&"document" in b){var f=document.getElementById(d);if(f){var g=f.value||f.innerHTML;return a.compile(d,g.replace(/^\s*|\s*$/g,""))}}else{if(c.hasOwnProperty(d)){return e}}},e=function(b){function c(){return c+""}return a.onerror(b),c.toString=function(){return"{Template Error}"},c},f=function(){a.prototype={$render:a.render,$escape:function(a){return"string"==typeof a?a.replace(/&(?![\w#]+;)|[<>"']/g,function(a){return{"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"}[a]}):a},$string:function(a){return"string"==typeof a||"number"==typeof a?a:"function"==typeof a?a():""}};var b=Array.prototype.forEach||function(a,b){for(var c=this.length>>>0,d=0;c>d;d++){d in this&&a.call(b,this[d],d,this)}},c=function(a,c){b.call(a,c)},d="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",e=/\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|'[^']*'|"[^"]*"|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,f=/[^\w$]+/g,g=RegExp(["\\b"+d.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),h=/\b\d[^,]*/g,i=/^,+|,+$/g,j=function(a){return a=a.replace(e,"").replace(f,",").replace(g,"").replace(h,"").replace(i,""),a=a?a.split(/,+/):[]
};return function(b,d){function w(b){return k+=b.split(/\n/).length-1,a.isCompress&&(b=b.replace(/[\n\r\t\s]+/g," ")),b=b.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),b=q[1]+"'"+b+"'"+q[2],b+"\n"}function x(b){var c=k;if(g?b=g(b):d&&(b=b.replace(/\n/g,function(){return k++,"$line="+k+";"})),0===b.indexOf("=")){var e=0!==b.indexOf("==");if(b=b.replace(/^=*|[\s;]*$/g,""),e&&a.isEscape){var f=b.replace(/\s*\([^\)]+\)/,"");m.hasOwnProperty(f)||/^(include|print)$/.test(f)||(b="$escape($string("+b+"))")}else{b="$string("+b+")"}b=q[1]+b+q[2]}return d&&(b="$line="+c+";"+b),y(b),b+"\n"}function y(a){a=j(a),c(a,function(a){l.hasOwnProperty(a)||(z(a),l[a]=!0)})}function z(a){var b;"print"===a?b=s:"include"===a?(n.$render=m.$render,b=t):(b="$data."+a,m.hasOwnProperty(a)&&(n[a]=m[a],b=0===a.indexOf("$")?"$helpers."+a:b+"===undefined?$helpers."+a+":"+b)),o+=a+"="+b+","}var e=a.openTag,f=a.closeTag,g=a.parser,h=b,i="",k=1,l={$data:!0,$helpers:!0,$out:!0,$line:!0},m=a.prototype,n={},o="var $helpers=this,"+(d?"$line=0,":""),p="".trim,q=p?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],r=p?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",s="function(content){"+r+"}",t="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+r+"}";c(h.split(e),function(a){a=a.split(f);var c=a[0],d=a[1];1===a.length?i+=w(c):(i+=x(c),d&&(i+=w(d)))}),h=i,d&&(h="try{"+h+"}catch(e){"+"e.line=$line;"+"throw e"+"}"),h="'use strict';"+o+q[0]+h+"return new String("+q[3]+")";try{var u=Function("$data",h);return u.prototype=n,u}catch(v){throw v.temp="function anonymous($data) {"+h+"}",v}}}()})(template,this),"function"==typeof define?define(function(a,b,c){c.exports=template}):"undefined"!=typeof exports&&(module.exports=template);(function(exports){exports.openTag="{";exports.closeTag="}";exports.parser=function(code){code=code.replace(/^\s/,"");var args=code.split(" ");var key=args.shift();var keywords=exports.keywords;
var fuc=keywords[key];if(fuc&&keywords.hasOwnProperty(key)){args=args.join(" ");code=fuc.call(code,args)}else{if(exports.prototype.hasOwnProperty(key)){args=args.join(",");code="=="+key+"("+args+");"}else{code=code.replace(/[\s;]*$/,"");code="="+code}}return code};exports.keywords={"if":function(code){return"if("+code+"){"},"else":function(code){code=code.split(" ");if(code.shift()==="if"){code=" if("+code.join(" ")+")"}else{code=""}return"}else"+code+"{"},"/if":function(){return"}"},"each":function(code){code=code.split(" ");var object=code[0]||"$data";var as=code[1]||"as";var value=code[2]||"$value";var index=code[3]||"$index";var args=value+","+index;if(as!=="as"){object="[]"}return"$each("+object+",function("+args+"){"},"/each":function(){return"});"},"echo":function(code){return"print("+code+");"},"include":function(code){code=code.split(" ");var id=code[0];var data=code[1];var args=id+(data?(","+data):"");return"include("+args+");"}};exports.helper("$each",function(data,callback){var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};if(isArray(data)){for(var i=0,len=data.length;i<len;i++){callback.call(data,data[i],i,data)}}else{for(i in data){callback.call(data,data[i],i)}}})})(template);

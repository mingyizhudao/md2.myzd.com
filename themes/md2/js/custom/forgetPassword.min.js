$(function(){var d=$("#forgetPassword-form"),a=d.attr("data-url-checkCode"),e=$("#btnSubmit");$.validator.addMethod("isMobile",function(i,g){var h=i.length;var f=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(g)||(h==11&&f.test(i))},"请填写正确的手机号码");$.validator.addMethod("isPassword",function(h,g){var f=/^[a-zA-Z0-9_]+$/;return this.optional(g)||(f.test(h))},"请填写字母、数字或下划线");e.click(function(){var g=c.form();if(g){var h=$("#ForgetPasswordForm_captcha_code").val();var f=d.serializeArray();$.ajax({type:"post",url:a+"?co_code="+h,data:f,success:function(i){if(i.status=="ok"){b()}else{J.hideMask();$("#ForgetPasswordForm_captcha_code-error").remove();$("#captchaCode").after('<div id="ForgetPasswordForm_captcha_code-error" class="error">'+i.error+"</div>");$("#ForgetPasswordForm_captcha_code").focus()}}})}});var c=d.validate({rules:{"ForgetPasswordForm[username]":{required:true,isMobile:true},"ForgetPasswordForm[verify_code]":{required:true,digits:true,maxlength:6,minlength:6},"ForgetPasswordForm[captcha_code]":{required:true},"ForgetPasswordForm[password_new]":{required:true,isPassword:true,maxlength:40,minlength:4}},messages:{"ForgetPasswordForm[username]":{required:"请输入手机号码",isMobile:"请输入正确的中国手机号码!"},"ForgetPasswordForm[verify_code]":{required:"请输入验证码",digits:"请输入正确的验证码",maxlength:"请输入正确的验证码",minlength:"请输入正确的验证码"},"ForgetPasswordForm[captcha_code]":{required:"请输入图形验证码"},"ForgetPasswordForm[password_new]":{required:"请输入新密码",maxlength:"请输入40位以内密码",minlength:"密码至少4位"}},errorElement:"div",errorPlacement:function(f,g){g.parents("div.input").find("div.error").remove();g.parents("div.input").find("div.errorMessage").remove();f.appendTo(g.parents("div.input"))}});function b(){disabledBtn(e);var g=d.serializeArray();var f=structure_formdata("ForgetPasswordForm",g);var h=do_encrypt(f,pubkey);var i={param:h};requestUrl=d.attr("data-url-action");returnUrl=d.attr("data-url-return");$.ajax({type:"post",url:requestUrl,data:i,success:function(j){console.log(j);if(j.status=="ok"){window.location.href=returnUrl+"?loginType=paw"}else{d.find("div.error").remove();for(error in j.errors){errerMsg=j.errors[error];inputKey="#ForgetPasswordForm_"+error;$(inputKey).focus();$(inputKey).parents(".inputBorder").after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(e)}}})}});
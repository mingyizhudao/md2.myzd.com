$(function(){var c=$("#patient-form"),d=$("#btnSubmit"),e=c.attr("data-url-return");$.validator.addMethod("isMobile",function(i,g){var h=i.length;var f=/^((0[0-9]{2,3})?([2-9][0-9]{6,7})$)|(^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9}))$/;return this.optional(g)||(f.test(i))},"请填写正确的电话号码");d.click(function(){var f=b.form();if(f){a()}});var b=c.validate({rules:{"patient[name]":{required:true,maxlength:45},"patient[mobile]":{required:true,isMobile:true},"patient[gender]":{required:true},"patient[birth_year]":{required:true},"patient[birth_month]":{required:true},"patient[state_id]":{required:true},"patient[city_id]":{required:true},"patient[disease_name]":{required:true,maxlength:50},"patient[disease_detail]":{required:true,maxlength:1000}},messages:{"patient[name]":{required:"请填写真实姓名",maxlength:"请将字数控制在45以内"},"patient[mobile]":{required:"请填写患者联系方式",isMobile:"请填写正确的电话号码"},"patient[gender]":{required:"请选择性别"},"patient[birth_year]":{required:"请选择出生年份"},"patient[birth_month]":{required:"请选择出生月份"},"patient[state_id]":{required:"请选择省份"},"patient[city_id]":{required:"请选择城市"},"patient[disease_name]":{required:"请输入疾病诊断",maxlength:"疾病诊断最长为50字"},"patient[disease_detail]":{required:"请输入病史描述",maxlength:"病史描述最长为1000字"}},errorElement:"div",errorPlacement:function(f,g){f.appendTo(g.parent())}});function a(){disabledBtn(d);requestUrl=c.attr("data-url-action");var f=c.serialize();$.ajax({type:"post",url:requestUrl,data:f,success:function(g){if(g.status=="ok"){e+="?id="+g.patient.id+"&returnUrl="+$returnUrl;window.location.href=e}else{c.find("div.error").remove();for(error in g.errors){errerMsg=g.errors[error];inputKey="#patient_"+error;$(inputKey).focus();$(inputKey).parent().after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(d)}},error:function(g,i,h){console.log(g);console.log(i);console.log(h)},complete:function(){enableBtn(d)}})}});
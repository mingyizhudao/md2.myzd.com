$(function(){var c=$("#booking-form"),d=$("#btnSubmit"),e=c.attr("data-url-return");$("input").change(function(){var f=$(this).attr("id");b.element("#"+f)});$.validator.addMethod("dataBeforeToday",function(i,g){var f=new Date();var h=new Date(i);return this.optional(g)||(h>f)},"日期必须大于今天");$.validator.addMethod("startdataBeforeEnddate",function(i,h){var g=new Date($("#booking_date_start").val());var f=new Date(i);var j=Math.abs((g-f))/(1000*60*60*24);return this.optional(h)||(f>g)},"最迟时间必须大于最早时间");d.click(function(){$(".noTravelType").remove();var g=$('input[name="booking[travel_type]"]').attr("value");if(g==""){$("#travel_type").after('<div class="noTravelType">请选择就诊意向</div>')}var f=b.form();if(f){if($('input[name="booking[expected_doctor]"]').val()!=""||$('input[name="booking[expected_hospital]"]').val()!=""||$('input[name="booking[expected_dept]"]').val()!=""){if(!($('input[name="booking[expected_doctor]"]').val()!=""&&$('input[name="booking[expected_hospital]"]').val()!=""&&$('input[name="booking[expected_dept]"]').val()!="")){$("#expectedError.error").remove();$("#expectedInfo").after('<div id="expectedError" class="error">请补全信息</div> ');return}}a()}});var b=c.validate({rules:{"booking[travel_type]":{required:true,},"booking[detail]":{required:true,minlength:1,maxlength:1000}},messages:{"booking[travel_type]":{required:"请选择就诊方式",},"booking[detail]":{required:"如无任何需求，请填写‘无’",minlength:"如无任何需求，请填写‘无’",maxlength:"请将字数控制在1000以内"}},errorElement:"div",errorPlacement:function(f,g){f.appendTo(g.parent())}});function a(){disabledBtn(d);var g=c.serializeArray();var f=structure_formdata("booking",g);var h=do_encrypt(f,pubkey);var i={param:h};requestUrl=c.attr("action");$.ajax({type:"post",url:requestUrl,data:i,success:function(j){if(j.status=="ok"){if($realName==0){J.customConfirm("就诊信息提交成功",'<div class="mt10 mb10">请您填写个人信息并通过实名认证，以便进行后续操作。</div>','<a data="cancel" class="w50">暂不操作</a>','<a data="ok" class="color-green w50">填写信息</a>',function(){location.href=$urlRealName},function(){e+="?bookingid="+j.booking.id+"&status=1&addBackBtn=1";window.location.href=e})}else{if($userDoctorCerts==0){J.hideMask();J.customConfirm("就诊信息提交成功",'<div class="mt10 mb10">请您上传证件，以便进行后续操作。</div>','<a data="cancel" class="w50">暂不操作</a>','<a data="ok" class="color-green w50">上传证件</a>',function(){location.href=$userDoctorUploadCert},function(){e+="?bookingid="+j.booking.id+"&status=1&addBackBtn=1";window.location.href=e})}else{e+="?bookingid="+j.booking.id+"&status=1&addBackBtn=1";window.location.href=e}}}else{c.find("div.error").remove();for(error in j.errors){errerMsg=j.errors[error];inputKey="#booking_"+error;$(inputKey).focus();$(inputKey).parent().after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(d);J.showToast("网络异常，请稍后预约","","2000")}},error:function(j,l,k){J.showToast("网络异常，请稍后预约","","2000");enableBtn(d);console.log(j);console.log(l);console.log(k)},complete:function(){}})}});
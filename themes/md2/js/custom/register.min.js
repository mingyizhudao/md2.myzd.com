$(function(){var d=$("#register-form"),a=d.attr("data-url-checkCode"),e=$("#btnSubmit");$.validator.addMethod("isMobile",function(i,g){var h=i.length;var f=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(g)||(h==11&&f.test(i))},"请填写正确的手机号码");$.validator.addMethod("isPassword",function(h,g){var f=/^[a-zA-Z0-9_]+$/;return this.optional(g)||(f.test(h))},"请填写字母、数字或下划线");e.click(function(){var g=c.form();if(g){var h=$("#UserRegisterForm_captcha_code").val();var f=d.serializeArray();$.ajax({type:"post",url:a+"?co_code="+h,data:f,success:function(i){if(i.status=="ok"){b()}else{J.hideMask();$("#UserRegisterForm_captcha_code-error").remove();$("#captchaCode").after('<div id="UserRegisterForm_captcha_code-error" class="error">'+i.error+"</div>");$("#UserRegisterForm_captcha_code").focus()}}})}});var c=d.validate({rules:{"UserRegisterForm[username]":{required:true,isMobile:true},"UserRegisterForm[captcha_code]":{required:true},"UserRegisterForm[verify_code]":{required:true,digits:true,maxlength:6,minlength:6},"UserRegisterForm[password]":{required:true,isPassword:true,maxlength:40,minlength:4}},messages:{"UserRegisterForm[username]":{required:"请输入手机号码",isMobile:"请输入正确的中国手机号码!"},"UserRegisterForm[captcha_code]":{required:"请输入图形验证码"},"UserRegisterForm[verify_code]":{required:"请输入验证码",digits:"请输入正确的验证码",maxlength:"请输入正确的验证码",minlength:"请输入正确的验证码"},"UserRegisterForm[password]":{required:"请输入密码",maxlength:"请输入40位以内密码",minlength:"密码至少4位"}},errorElement:"div",errorPlacement:function(f,g){g.parents("div.input").find("div.error").remove();g.parents("div.input").find("div.errorMessage").remove();f.appendTo(g.parents("div.input"))}});function b(){disabledBtn(e);var g=d.serializeArray();var f=structure_formdata("UserRegisterForm",g);var i=do_encrypt(f,pubkey);var j={param:i};var h=d.attr("data-url-action");var k=d.attr("data-url-return");$.ajax({type:"post",url:h,data:j,success:function(l){if(l.status=="ok"){window.location.href=k+"?register="+l.register}else{d.find("div.error").remove();for(error in l.errors){errerMsg=l.errors[error];inputKey="#UserRegisterForm_"+error;$(inputKey).focus();$(inputKey).parents(".inputBorder").after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(e)}},error:function(l,n,m){enableBtn(e);console.log(l);console.log(n);console.log(m)},})}});
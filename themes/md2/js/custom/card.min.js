$(function(){var c=$("#card-form"),d=$("#submitBtn");d.click(function(){var f=/^(\d{15,20})$/;var g=$('input[name="card[card_no]"]').val();if(!f.test(g)){J.showToast("银行卡号不正确","","1500");return}var e=b.form();if(e){a()}});var b=c.validate({rules:{"card[name]":{required:true},"card[card_no]":{required:true},"card[state_id]":{required:true},"card[city_id]":{required:true},"card[bank]":{required:true},"card[subbranch]":{required:true},"card[is_default]":{required:true}},messages:{"card[name]":{required:"请输入姓名"},"card[card_no]":{required:"请输入银行卡号"},"card[state_id]":{required:"省份"},"card[city_id]":{required:"城市"},"card[bank]":{required:"开户银行"},"card[subbranch]":{required:"银行支行"},"card[is_default]":{required:"设为默认"}},errorElement:"div",errorPlacement:function(e,f){f.removeClass("error");f.addClass("error")}});function a(){disabled(d);var f=c.serializeArray();var g=c.attr("data-action-url");var j=c.attr("data-return-url");var e=structure_formdata("card",f);var h=do_encrypt(e,pubkey);var i={param:h};$.ajax({type:"post",url:g,data:i,success:function(k){if(k.status=="ok"){location.href=j}else{enable(d)}},error:function(k,m,l){enable(d);console.log(k);console.log(m);console.log(l)},})}});
$(function(){var c=$("#booking-form"),d=$("#btnSubmit"),e=c.attr("data-url-return");d.click(function(){$(".noTravelType").remove();var g=$('input[name="booking[travel_type]"]').attr("value");if(g==""){$("#travel_type").after('<div class="noTravelType">请选择就诊意向</div>');return}var f=b.form();if(f){a()}});var b=c.validate({rules:{"booking[detail]":{required:true,minlength:1,maxlength:1000}},messages:{"booking[detail]":{required:"如无任何需求，请填写‘无’",minlength:"如无任何需求，请填写‘无’",maxlength:"请将字数控制在1000以内"}},errorElement:"div",errorPlacement:function(f,g){f.appendTo(g.parent())}});function a(){disabledBtn(d);var g=c.serializeArray();var f=structure_formdata("booking",g);var h=do_encrypt(f,pubkey);var i={param:h};requestUrl=c.attr("action");$.ajax({type:"post",url:requestUrl,data:i,success:function(j){if(j.status=="ok"){e+="?refNo="+j.salesOrderRefNo+"&bookingId="+j.booking.id;window.location.href=e}else{c.find("div.error").remove();for(error in j.errors){errerMsg=j.errors[error];inputKey="#booking_"+error;$(inputKey).focus();$(inputKey).parent().after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(d);J.showToast("网络异常，请稍后预约","","2000")}},error:function(j,l,k){J.showToast("网络异常，请稍后预约","","2000");enableBtn(d);console.log(j);console.log(l);console.log(k)},complete:function(){}})}});
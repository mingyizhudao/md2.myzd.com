$(function(){var domForm=$("#patient-form"),btnSubmit=$("#btnSubmit"),returnUrl=domForm.attr("data-url-return");btnSubmit.click(function(){$(".noTravelType").remove();var travelType=$('input[name="booking[travel_type]"]').attr("value");if(travelType==""){J.showToast("请选择就诊意向","","1500");return}var patient_id=$('input[name="booking[patient_id]"]').attr("value");if(patient_id==""){J.showToast("请选择您的患者","","1500");return}var bool=validator.form();if(bool){formAjaxSubmit()}});var validator=domForm.validate({rules:{"booking[detail]":{required:true,minlength:1,maxlength:1000}},messages:{"booking[detail]":{required:"如无任何需求，请填写‘无’",minlength:"如无任何需求，请填写‘无’",maxlength:"请将字数控制在1000以内"}},errorElement:"div",errorPlacement:function(error,element){error.appendTo(element.parent())}});function formAjaxSubmit(){disabledBtn(btnSubmit);var formdata=domForm.serializeArray();var dataArray=structure_formdata("booking",formdata);var encryptContext=do_encrypt(dataArray,pubkey);var param={param:encryptContext};requestUrl=domForm.attr("action");$.ajax({type:"post",url:requestUrl,data:param,success:function(data){if(data.status=="ok"){sessionStorage.removeItem("travelType");sessionStorage.removeItem("detail");returnUrl+="?refNo="+data.salesOrderRefNo+"&bookingId="+data.booking.id;window.location.href=returnUrl}else{domForm.find("div.error").remove();for(error in data.errors){errerMsg=data.errors[error];inputKey="#booking_"+error;$(inputKey).focus();$(inputKey).parent().after("<div class='error'>"+errerMsg+"</div> ")}enableBtn(btnSubmit);J.showToast("网络异常，请稍后预约","","2000")}},error:function(XmlHttpRequest,textStatus,errorThrown){J.showToast("网络异常，请稍后预约","","2000");enableBtn(btnSubmit);console.log(XmlHttpRequest);console.log(textStatus);console.log(errorThrown)},complete:function(){}})}});